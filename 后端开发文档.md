# 移动端 Wiki 知识库 APP 后端 ## 后端开发文档

## 目录

1. [项目概述](#1-项目概述)

2. [技术栈选型](#2-技术栈选型)

3. [系统架构设计](#3-系统架构设计)

4. [数据库设计](#4-数据库设计)

5. [API 接口设计](#5-api接口设计)

6. [安全设计](#6-安全设计)

7. [文件存储方案](#7-文件存储方案)

8. [部署方案](#8-部署方案)

9. [开发计划](#9-开发计划)

10. [附录](#10-附录)

## 1. 项目概述

### 1.1 项目背景

为配合移动端 Wiki 知识库 APP 的开发，需要构建一个高性能、可扩展的后端服务，提供用户管理、文档管理、电子书 (PDF)
管理等核心功能，支持移动端的数据交互和文件存储需求。

### 1.2 功能概述

后端服务将提供以下核心功能：

* 用户认证与授权

* 文档的 CRUD 操作

* 电子书 (PDF) 的上传、存储、管理

* 数据同步与备份

* 搜索服务

* 统计分析

### 1.3 性能目标

* 接口响应时间：95% 的请求 ≤ 500ms

* 支持并发用户数：1000+

* 文件上传速度：支持最大 100MB 文件，平均上传速度 ≥ 1MB/s

* 系统可用性：99.9%

## 2. 技术栈选型

### 2.1 开发语言

* **主语言**：Java 17

* **辅助脚本**：Python 3.9（用于数据处理和分析）

### 2.2 核心框架

* **Web 框架**：Spring Boot 3.1.x

* **安全框架**：Spring Security + JWT

* **ORM 框架**：Spring Data JPA + Hibernate

* **API 文档**：SpringDoc OpenAPI (Swagger)

### 2.3 数据库

* **主数据库**：PostgreSQL 14（关系型数据存储）

* **缓存**：Redis 7.0（会话管理、热点数据缓存）

* **搜索引擎**：Elasticsearch 8.6（全文检索）

### 2.4 文件存储

* **对象存储**：MinIO（兼容 S3 API 的文件存储）

* **文件服务器**：Nginx（静态资源服务）

### 2.5 部署与监控

* **容器化**：Docker + Docker Compose

* **CI/CD**：Jenkins

* **监控**：Prometheus + Grafana

* **日志管理**：ELK Stack (Elasticsearch, Logstash, Kibana)

## 3. 系统架构设计

### 3.1 整体架构

采用分层微服务架构，主要包含以下服务：

```
┌─────────────────────────────────────────────────────────────┐

│                      客户端应用                             │

│                (Flutter iOS/Android App)                    │

└───────────────────────────────┬─────────────────────────────┘

&#x20;                               │

┌───────────────────────────────▼─────────────────────────────┐

│                      API网关层                              │

│        (认证授权、请求路由、负载均衡、限流熔断)              │

└───┬───────────────┬───────────────┬───────────────┬─────────┘

&#x20;   │               │               │               │

┌───▼───┐       ┌───▼───┐       ┌───▼───┐       ┌───▼───┐

│用户服务│       │文档服务│       │电子书服务│      │搜索服务│

└───┬───┘       └───┬───┘       └───┬───┘       └───┬───┘

&#x20;   │               │               │               │

┌───▼───────────────▼───────────────▼───────────────▼───┐

│                    数据持久层                           │

│  (PostgreSQL, Redis, Elasticsearch, MinIO对象存储)      │

└─────────────────────────────────────────────────────────┘
```

### 3.2 核心服务职责

1. **API 网关**

* 请求路由

* 认证与授权

* 限流与熔断

* 请求日志记录

* 简单的请求验证

1. **用户服务**

* 用户注册、登录、注销

* 用户信息管理

* 权限管理

* 会话管理

1. **文档服务**

* 文档的创建、查询、更新、删除

* 文档分类管理

* 文档版本控制

* 文档统计

1. **电子书服务**

* 电子书元信息管理

* PDF 文件上传与存储

* 电子书分类与标签

* 电子书阅读记录

* 书签管理

1. **搜索服务**

* 文档全文检索

* 电子书检索

* 搜索建议

* 搜索历史

## 4. 数据库设计

### 4.1 ER 图概览

```
┌───────────┐       ┌────────────┐       ┌────────────┐

│   User    │1    n│   Document  │       │   Ebook    │

├───────────┤◄────►├────────────┤       ├────────────┤

│ id        │       │ id         │       │ id         │

│ username  │       │ title      │       │ title      │

│ email     │       │ content    │       │ author     │

│ password  │       │ user\_id    │       │ file\_key   │

│ avatar    │       │ category\_id│       │ cover\_key  │

└───────────┘       │ created\_at │       │ user\_id    │

&#x20;      ▲            │ updated\_at │       │ category\_id│

&#x20;      │            └────────────┘       │ created\_at │

&#x20;      │                   ▲             │ updated\_at │

&#x20;      │                   │             └────────────┘

&#x20;      │                   │                    ▲

&#x20;      │                   │                    │

┌──────┴─────┐       ┌─────┴──────┐       ┌─────┴──────┐

│ UserRole   │       │  Category  │       │  Bookmark  │

├────────────┤       ├────────────┤       ├────────────┤

│ id         │       │ id         │       │ id         │

│ user\_id    │       │ name       │       │ ebook\_id   │

│ role\_id    │       │ parent\_id  │       │ page\_num   │

└────────────┘       │ type       │       │ note       │

&#x20;                    └────────────┘       │ created\_at │

&#x20;                                          └────────────┘
```

### 4.2 核心表结构

#### 4.2.1 用户相关表

**users** - 用户表

```
CREATE TABLE users (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   username VARCHAR(50) NOT NULL UNIQUE,

&#x20;   email VARCHAR(100) NOT NULL UNIQUE,

&#x20;   password\_hash VARCHAR(255) NOT NULL,

&#x20;   avatar\_url VARCHAR(255),

&#x20;   status SMALLINT NOT NULL DEFAULT 1, -- 1: active, 0: inactive

&#x20;   created\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   updated\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP

);
```

**roles** - 角色表

```
CREATE TABLE roles (

&#x20;   id SERIAL PRIMARY KEY,

&#x20;   name VARCHAR(50) NOT NULL UNIQUE,

&#x20;   description VARCHAR(255)

);
```

**user\_roles** - 用户角色关联表

```
CREATE TABLE user\_roles (

&#x20;   user\_id BIGINT NOT NULL,

&#x20;   role\_id INT NOT NULL,

&#x20;   PRIMARY KEY (user\_id, role\_id),

&#x20;   FOREIGN KEY (user\_id) REFERENCES users(id) ON DELETE CASCADE,

&#x20;   FOREIGN KEY (role\_id) REFERENCES roles(id)

);
```

#### 4.2.2 文档相关表

**categories** - 分类表

```
CREATE TABLE categories (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   name VARCHAR(100) NOT NULL,

&#x20;   parent\_id BIGINT,

&#x20;   type VARCHAR(20) NOT NULL, -- 'document' or 'ebook'

&#x20;   user\_id BIGINT, -- 个人分类，NULL表示公共分类

&#x20;   created\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   updated\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   FOREIGN KEY (parent\_id) REFERENCES categories(id) ON DELETE SET NULL,

&#x20;   FOREIGN KEY (user\_id) REFERENCES users(id) ON DELETE CASCADE

);
```

**documents** - 文档表

```
CREATE TABLE documents (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   title VARCHAR(255) NOT NULL,

&#x20;   content TEXT,

&#x20;   user\_id BIGINT NOT NULL,

&#x20;   category\_id BIGINT,

&#x20;   is\_favorite BOOLEAN DEFAULT FALSE,

&#x20;   version INT NOT NULL DEFAULT 1,

&#x20;   word\_count INT DEFAULT 0,

&#x20;   created\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   updated\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   FOREIGN KEY (user\_id) REFERENCES users(id) ON DELETE CASCADE,

&#x20;   FOREIGN KEY (category\_id) REFERENCES categories(id) ON DELETE SET NULL

);
```

**document\_versions** - 文档版本表

```
CREATE TABLE document\_versions (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   document\_id BIGINT NOT NULL,

&#x20;   content TEXT NOT NULL,

&#x20;   version INT NOT NULL,

&#x20;   created\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   FOREIGN KEY (document\_id) REFERENCES documents(id) ON DELETE CASCADE

);
```

**tags** - 标签表

```
CREATE TABLE tags (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   name VARCHAR(50) NOT NULL,

&#x20;   user\_id BIGINT,

&#x20;   created\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   UNIQUE(name, user\_id),

&#x20;   FOREIGN KEY (user\_id) REFERENCES users(id) ON DELETE CASCADE

);
```

**document\_tags** - 文档标签关联表

```
CREATE TABLE document\_tags (

&#x20;   document\_id BIGINT NOT NULL,

&#x20;   tag\_id BIGINT NOT NULL,

&#x20;   PRIMARY KEY (document\_id, tag\_id),

&#x20;   FOREIGN KEY (document\_id) REFERENCES documents(id) ON DELETE CASCADE,

&#x20;   FOREIGN KEY (tag\_id) REFERENCES tags(id) ON DELETE CASCADE

);
```

#### 4.2.3 电子书相关表

**ebooks** - 电子书表

```
CREATE TABLE ebooks (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   title VARCHAR(255) NOT NULL,

&#x20;   author VARCHAR(100),

&#x20;   file\_key VARCHAR(255) NOT NULL UNIQUE, -- 存储在MinIO中的键

&#x20;   file\_size BIGINT NOT NULL, -- 文件大小(字节)

&#x20;   cover\_key VARCHAR(255), -- 封面图片在MinIO中的键

&#x20;   page\_count INT DEFAULT 0,

&#x20;   description TEXT,

&#x20;   user\_id BIGINT NOT NULL,

&#x20;   category\_id BIGINT,

&#x20;   is\_favorite BOOLEAN DEFAULT FALSE,

&#x20;   download\_count INT DEFAULT 0,

&#x20;   view\_count INT DEFAULT 0,

&#x20;   upload\_date TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   last\_read\_date TIMESTAMP,

&#x20;   last\_read\_page INT DEFAULT 0,

&#x20;   FOREIGN KEY (user\_id) REFERENCES users(id) ON DELETE CASCADE,

&#x20;   FOREIGN KEY (category\_id) REFERENCES categories(id) ON DELETE SET NULL

);
```

**ebook\_tags** - 电子书标签关联表

```
CREATE TABLE ebook\_tags (

&#x20;   ebook\_id BIGINT NOT NULL,

&#x20;   tag\_id BIGINT NOT NULL,

&#x20;   PRIMARY KEY (ebook\_id, tag\_id),

&#x20;   FOREIGN KEY (ebook\_id) REFERENCES ebooks(id) ON DELETE CASCADE,

&#x20;   FOREIGN KEY (tag\_id) REFERENCES tags(id) ON DELETE CASCADE

);
```

**bookmarks** - 书签表

```
CREATE TABLE bookmarks (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   ebook\_id BIGINT NOT NULL,

&#x20;   page\_number INT NOT NULL,

&#x20;   note TEXT,

&#x20;   user\_id BIGINT NOT NULL,

&#x20;   created\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   updated\_at TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   FOREIGN KEY (ebook\_id) REFERENCES ebooks(id) ON DELETE CASCADE,

&#x20;   FOREIGN KEY (user\_id) REFERENCES users(id) ON DELETE CASCADE,

&#x20;   UNIQUE(ebook\_id, page\_number, user\_id)

);
```

#### 4.2.4 系统表

**user\_activity** - 用户活动表

```
CREATE TABLE user\_activity (

&#x20;   id BIGSERIAL PRIMARY KEY,

&#x20;   user\_id BIGINT NOT NULL,

&#x20;   activity\_type VARCHAR(50) NOT NULL, -- 'view', 'download', 'create', etc.

&#x20;   resource\_type VARCHAR(50) NOT NULL, -- 'document', 'ebook'

&#x20;   resource\_id BIGINT NOT NULL,

&#x20;   activity\_time TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP,

&#x20;   FOREIGN KEY (user\_id) REFERENCES users(id) ON DELETE CASCADE

);
```

## 5. API 接口设计

### 5.1 接口规范

#### 5.1.1 基础信息

* 基础路径：`/api/v1`

* 数据格式：JSON

* 字符编码：UTF-8

* 日期格式：`yyyy-MM-dd HH:mm:ss` 或时间戳

#### 5.1.2 通用响应格式

成功响应：

```
{

&#x20; "code": 200,

&#x20; "message": "success",

&#x20; "data": {

&#x20;   // 响应数据

&#x20; }

}
```

错误响应：

```
{

&#x20; "code": 400,

&#x20; "message": "错误描述信息",

&#x20; "errors": \[

&#x20;   {

&#x20;     "field": "fieldName",

&#x20;     "message": "字段错误信息"

&#x20;   }

&#x20; ]

}
```

分页响应：

```
{

&#x20; "code": 200,

&#x20; "message": "success",

&#x20; "data": {

&#x20;   "items": \[

&#x20;     // 列表数据

&#x20;   ],

&#x20;   "pagination": {

&#x20;     "page": 1,

&#x20;     "size": 10,

&#x20;     "total": 100,

&#x20;     "pages": 10

&#x20;   }

&#x20; }

}
```

### 5.2 认证接口

#### 5.2.1 用户登录

* **URL**: `/auth/login`

* **方法**: POST

* **请求体**:

```
{

&#x20; "username": "string",

&#x20; "password": "string"

}
```

* **响应**:

```
{

&#x20; "code": 200,

&#x20; "message": "success",

&#x20; "data": {

&#x20;   "token": "JWT令牌",

&#x20;   "refreshToken": "刷新令牌",

&#x20;   "expiresIn": 3600,

&#x20;   "user": {

&#x20;     "id": 1,

&#x20;     "username": "string",

&#x20;     "email": "string",

&#x20;     "avatarUrl": "string"

&#x20;   }

&#x20; }

}
```

#### 5.2.2 刷新令牌

* **URL**: `/auth/refresh`

* **方法**: POST

* **请求体**:

```
{

&#x20; "refreshToken": "string"

}
```

* **响应**: 同登录响应，返回新的 token

#### 5.2.3 用户注册

* **URL**: `/auth/register`

* **方法**: POST

* **请求体**:

```
{

&#x20; "username": "string",

&#x20; "email": "string",

&#x20; "password": "string"

}
```

* **响应**: 返回用户信息和令牌

### 5.3 用户接口

#### 5.3.1 获取当前用户信息

* **URL**: `/users/me`

* **方法**: GET

* **请求头**: `Authorization: Bearer {token}`

* **响应**: 返回当前用户详细信息

#### 5.3.2 更新用户信息

* **URL**: `/users/me`

* **方法**: PUT

* **请求头**: `Authorization: Bearer {token}`

* **请求体**:

```
{

&#x20; "username": "string",

&#x20; "email": "string",

&#x20; "avatarUrl": "string"

}
```

* **响应**: 返回更新后的用户信息

### 5.4 文档接口

#### 5.4.1 创建文档

* **URL**: `/documents`

* **方法**: POST

* **请求头**: `Authorization: Bearer {token}`

* **请求体**:

```
{

&#x20; "title": "string",

&#x20; "content": "string",

&#x20; "categoryId": 1,

&#x20; "tagIds": \[1, 2, 3]

}
```

* **响应**: 返回创建的文档信息

#### 5.4.2 获取文档列表

* **URL**: `/documents`

* **方法**: GET

* **请求头**: `Authorization: Bearer {token}`

* **参数**:

    *   `page`: 页码，默认 1

    *   `size`: 每页条数，默认 10

    *   `categoryId`: 分类 ID，可选

    *   `keyword`: 搜索关键词，可选

    *   `sort`: 排序字段，默认 createdAt

    *   `order`: 排序方向，asc/desc，默认 desc

* **响应**: 分页返回文档列表

#### 5.4.3 获取文档详情

* **URL**: `/documents/{id}`

* **方法**: GET

* **请求头**: `Authorization: Bearer {token}`

* **响应**: 返回文档详细信息

#### 5.4.4 更新文档

* **URL**: `/documents/{id}`

* **方法**: PUT

* **请求头**: `Authorization: Bearer {token}`

* **请求体**: 同创建文档

* **响应**: 返回更新后的文档信息

#### 5.4.5 删除文档

* **URL**: `/documents/{id}`

* **方法**: DELETE

* **请求头**: `Authorization: Bearer {token}`

* **响应**: 成功提示

### 5.5 电子书接口

#### 5.5.1 上传电子书元信息

* **URL**: `/ebooks`

* **方法**: POST

* **请求头**: `Authorization: Bearer {token}`

* **请求体**:

```
{

&#x20; "title": "string",

&#x20; "author": "string",

&#x20; "description": "string",

&#x20; "categoryId": 1,

&#x20; "tagIds": \[1, 2, 3],

&#x20; "fileSize": 1024000

}
```

* **响应**:

```
{

&#x20; "code": 200,

&#x20; "message": "success",

&#x20; "data": {

&#x20;   "id": 1,

&#x20;   "uploadUrl": "文件上传URL",

&#x20;   "fileKey": "文件存储键"

&#x20; }

}
```

#### 5.5.2 上传电子书文件

* **URL**: 使用上一步获取的 uploadUrl

* **方法**: PUT

* **请求体**: 文件二进制数据

* **响应**: 上传成功提示

#### 5.5.3 确认电子书上传完成

* **URL**: `/ebooks/{id}/complete`

* **方法**: POST

* **请求头**: `Authorization: Bearer {token}`

* **请求体**:

```
{

&#x20; "pageCount": 100

}
```

* **响应**: 返回完整的电子书信息

#### 5.5.4 获取电子书列表

* **URL**: `/ebooks`

* **方法**: GET

* **请求头**: `Authorization: Bearer {token}`

* **参数**: 类似文档列表，增加筛选条件

* **响应**: 分页返回电子书列表

#### 5.5.5 获取电子书详情

* **URL**: `/ebooks/{id}`

* **方法**: GET

* **请求头**: `Authorization: Bearer {token}`

* **响应**: 返回电子书详细信息，包含下载 URL

#### 5.5.6 获取电子书下载 URL

* **URL**: `/ebooks/{id}/download`

* **方法**: GET

* **请求头**: `Authorization: Bearer {token}`

* **响应**: 返回带签名的临时下载 URL

#### 5.5.7 电子书书签操作

* **创建书签**:

    *   **URL**: `/ebooks/{id}/bookmarks`

    *   **方法**: POST

    *   **请求体**: `{"pageNumber": 1, "note": "string"}`

* **获取书签列表**:

    *   **URL**: `/ebooks/{id}/bookmarks`

    *   **方法**: GET

* **更新书签**:

    *   **URL**: `/bookmarks/{id}`

    *   **方法**: PUT

    *   **请求体**: `{"note": "string"}`

* **删除书签**:

    *   **URL**: `/bookmarks/{id}`

    *   **方法**: DELETE

### 5.6 搜索接口

#### 5.6.1 全局搜索

* **URL**: `/search`

* **方法**: GET

* **请求头**: `Authorization: Bearer {token}`

* **参数**:

    *   `keyword`: 搜索关键词，必填

    *   `type`: 搜索类型，all/document/ebook，默认 all

    *   `page`: 页码，默认 1

    *   `size`: 每页条数，默认 10

* **响应**: 分页返回搜索结果

## 6. 安全设计

### 6.1 认证与授权

* 采用 JWT (JSON Web Token) 进行身份认证

* 令牌有效期：访问令牌 2 小时，刷新令牌 7 天

* 基于角色的访问控制 (RBAC)

* 敏感操作需要二次验证

### 6.2 数据安全

* 密码存储：使用 BCrypt 算法加密存储

* 敏感数据传输：全站 HTTPS 加密

* 数据库敏感字段：加密存储

* 定期数据备份：每日全量备份，实时增量备份

### 6.3 API 安全

* 接口限流：基于 IP 和用户的限流策略

* 请求验证：所有输入参数进行验证

* 防止 SQL 注入：使用参数化查询

* 防止 XSS 攻击：输入过滤和输出编码

* 防止 CSRF 攻击：使用 CSRF 令牌

### 6.4 文件安全

* 文件类型验证：检查文件内容而非仅依赖扩展名

* 文件大小限制：单个文件最大 100MB

* 病毒扫描：上传文件进行病毒扫描

* 访问控制：签名 URL 控制文件访问权限和有效期

## 7. 文件存储方案

### 7.1 存储架构

使用 MinIO 作为对象存储服务，提供兼容 S3 API 的文件存储能力。

### 7.2 存储结构

```
buckets/

├── user-avatars/         # 用户头像

│   └── {user\_id}/

│       └── avatar.jpg

├── document-attachments/ # 文档附件

│   └── {document\_id}/

│       └── {file\_name}

├── ebook-covers/         # 电子书封面

│   └── {ebook\_id}/

│       └── cover.jpg

└── ebooks/               # 电子书文件

&#x20;   └── {user\_id}/

&#x20;       └── {file\_key}.pdf
```

### 7.3 文件上传流程

1. 客户端请求上传权限，服务端生成预签名 URL 和文件存储键

2. 客户端直接向 MinIO 上传文件（使用预签名 URL）

3. 上传完成后，客户端通知服务端，服务端验证文件完整性

4. 服务端更新数据库记录，完成上传流程

### 7.4 文件下载流程

1. 客户端请求下载文件，服务端验证权限

2. 服务端生成带签名的临时下载 URL（有效期 1 小时）

3. 客户端使用该 URL 直接从 MinIO 下载文件

### 7.5 存储策略

* 标准存储：默认存储类别

* 生命周期管理：30 天未访问的非热门文件自动转为低频访问存储

* 数据冗余：多副本存储，确保数据可靠性

## 8. 部署方案

### 8.1 环境划分

* 开发环境 (dev)：供开发人员使用

* 测试环境 (test)：供测试人员使用

* 预发布环境 (staging)：与生产环境配置一致，用于最终验证

* 生产环境 (prod)：正式服务环境

### 8.2 容器化部署

使用 Docker 和 Docker Compose 实现容器化部署：

```
\# docker-compose.yml 示例

version: '3.8'

services:

&#x20; api-gateway:

&#x20;   image: wiki-api-gateway:latest

&#x20;   ports:

&#x20;     \- "8080:8080"

&#x20;   depends\_on:

&#x20;     \- user-service

&#x20;     \- document-service

&#x20;     \- ebook-service

&#x20;     \- search-service

&#x20;   environment:

&#x20;     \- SPRING\_PROFILES\_ACTIVE=prod

&#x20;   restart: always

&#x20; user-service:

&#x20;   image: wiki-user-service:latest

&#x20;   depends\_on:

&#x20;     \- postgres

&#x20;     \- redis

&#x20;   environment:

&#x20;     \- SPRING\_PROFILES\_ACTIVE=prod

&#x20;   restart: always

&#x20; \# 其他服务配置...

&#x20; postgres:

&#x20;   image: postgres:14-alpine

&#x20;   volumes:

&#x20;     \- postgres-data:/var/lib/postgresql/data

&#x20;   environment:

&#x20;     \- POSTGRES\_PASSWORD=secret

&#x20;     \- POSTGRES\_DB=wiki

&#x20;   restart: always

&#x20; redis:

&#x20;   image: redis:7-alpine

&#x20;   volumes:

&#x20;     \- redis-data:/data

&#x20;   restart: always

&#x20; minio:

&#x20;   image: minio/minio

&#x20;   volumes:

&#x20;     \- minio-data:/data

&#x20;   environment:

&#x20;     \- MINIO\_ROOT\_USER=minioadmin

&#x20;     \- MINIO\_ROOT\_PASSWORD=minioadmin

&#x20;   command: server /data --console-address ":9001"

&#x20;   restart: always

volumes:

&#x20; postgres-data:

&#x20; redis-data:

&#x20; minio-data:
```

### 8.3 CI/CD 流程

1. 开发人员提交代码到 Git 仓库

2. Jenkins 检测到代码变更，触发自动构建

3. 执行单元测试和集成测试

4. 测试通过后，构建 Docker 镜像并推送到镜像仓库

5. 自动部署到测试环境

6. 测试通过后，手动确认部署到生产环境

### 8.4 监控与告警

* 使用 Prometheus 收集系统和应用 metrics

* 使用 Grafana 创建监控仪表盘

* 设置关键指标告警（响应时间、错误率、系统资源等）

* 告警渠道：邮件、短信、企业微信

## 9. 开发计划

### 9.1 阶段划分

| 阶段      | 时间      | 主要任务                | 交付物          |
|---------|---------|---------------------|--------------|
| 需求分析与设计 | 第 1 周   | 需求细化、架构设计、数据库设计     | 详细设计文档、数据库脚本 |
| 基础框架搭建  | 第 2 周   | 项目初始化、核心框架集成、基础组件开发 | 基础项目框架       |
| 认证与用户服务 | 第 3 周   | 用户认证、授权、用户管理功能开发    | 用户服务模块       |
| 文档服务开发  | 第 4-5 周 | 文档 CRUD、分类、版本控制功能   | 文档服务模块       |
| 电子书服务开发 | 第 6-7 周 | 电子书元数据管理、文件上传下载     | 电子书服务模块      |
| 搜索服务开发  | 第 8 周   | 全文检索、搜索建议功能         | 搜索服务模块       |
| 集成测试    | 第 9 周   | 模块间集成测试、接口测试        | 测试报告、问题清单    |
| 性能优化    | 第 10 周  | 性能测试、优化瓶颈、安全加固      | 优化报告、安全审计报告  |
| 部署上线    | 第 11 周  | 环境部署、数据迁移、监控配置      | 生产环境、部署文档    |

### 9.2 里程碑

1. **M1（第 2 周末）**：基础框架搭建完成

* 项目骨架搭建完成

* 数据库设计与初始化脚本

* 基础组件开发完成

1. **M2（第 5 周末）**：用户与文档服务完成

* 用户认证与管理功能可用

* 文档管理核心功能可用

* 基础 API 测试通过

1. **M3（第 7 周末）**：电子书服务完成

* 电子书上传与管理功能可用

* 文件存储服务集成完成

* 书签功能可用

1. **M4（第 11 周末）**：系统上线

* 所有服务部署完成

* 监控系统正常运行

* 系统稳定可用

## 10. 附录

### 10.1 常用工具与命令

* 数据库迁移：`./mvnw flyway:migrate`

* 单元测试：`./mvnw test`

* 构建镜像：`docker build -t service-name:version .`

* 启动服务：`docker-compose up -d`

### 10.2 接口文档

* 开发环境：[http://dev-api.example.com/swagger-ui.html](http://dev-api.example.com/swagger-ui.html)

* 测试环境：[http://test-api.example.com/swagger-ui.html](http://test-api.example.com/swagger-ui.html)

* 生产环境：[http://api.example.com/swagger-ui.html](http://api.example.com/swagger-ui.html) （需认证）

### 10.3 联系方式

* 项目负责人：\[姓名]，\[邮箱]

* 技术支持：\[邮箱]，\[电话]

### 10.4 变更记录

| 版本   | 日期         | 变更内容 | 变更人   |
|------|------------|------|-------|
| v1.0 | YYYY-MM-DD | 初始版本 | \[姓名] |

***

本开发文档将根据项目进展情况进行持续更新和完善，如有任何疑问或建议，请联系项目负责人。

> （注：文档部分内容可能由 AI 生成）